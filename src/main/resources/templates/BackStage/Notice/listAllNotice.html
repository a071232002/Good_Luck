<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link th:href="@{/css/BackStage/indexCSS/styles.css}" rel="stylesheet" />
<link th:href="@{/css/BackStage/indexCSS/index.css}" rel="stylesheet" />
<title>Insert title here</title>
<script th:src="@{/js/jquery-1.11.3.min.js}"></script>
</head>   
<head>
	<style>
		h1 {
			text-align: center;
			color: red;
		}
		 /* 初始隱藏放大顯示的容器 */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 2147483647; /* 設定 z-index 值為較大的數字 */
        }

        /* 放大顯示的圖片樣式 */
        .lightbox img {
            max-width: 80%;
            max-height: 80%;
        }
        main{
		   padding: 20px 20px;
		}

		input {
		    width: 60px;
		}
	</style>
</head>
<body>
   <div th:replace="BackStage/HTMLTool/nav :: nav"></div>
<main>
<h1 style="text-align: center;
			 border-radius: 10px;
			 width:80%;
             color: #fff; /* 字體顏色 */
             background-color: #3498db; /* 背景顏色 */
             padding: 20px; /* 內邊距 */
             margin: 0px auto; /* 邊距 */
             margin-bottom: 20px;
             box-shadow: 0 4px 6px rgba(0, 0, 0, 0.9); /* 底部陰影效果 */">最新公告管理</h1>
    <table id="example" class="display" style="width: 100%">
        <thead>
            <tr>
                <th>最新公告編號</th>
                <th>員工編號</th>
                <th>最新公告時間</th>
                <th>最新公告內容</th>
                <th>最新公告狀態</th>
                <th>修改</th>
            </tr>
        </thead>
        <tbody>
            <th:block th:each="notice : ${noticeListData}">
                <tr>
                    <td th:text="${notice.noticeNo}"></td>
                    <td th:text="${notice.empNo}"></td>
                    <td th:text="${#dates.format(notice.noticeTime, 'yyyy/MM/dd HH:mm:ss')}"></td>
                    <td th:text="${notice.noticeContent}"></td>
                    <td th:text="${notice.noticeStatus}">
                        <span th:if="${notice.noticeStatus == 0}" th:text="下架"></span>
                        <span th:if="${notice.noticeStatus == 1}" th:text="上架"></span>
                    </td>
                    <td>
                        <form method="post" th:action="@{updateNotice}">
                            <input type="hidden" name="noticeNo" th:value="${notice.noticeNo}">
                            <input type="submit" value="修改">
                        </form>
                    </td>
                </tr>
            </th:block>
        </tbody>
    </table>
    <br>
    
   <script>
   new DataTable('#example', {
   	"stateSave": true,
   	"iDisplayLength": 5,
       initComplete: function () {
       	var table = this.api();

           // Get the current value of stateSave
           var currentStateSaveValue = table.settings()[0].oFeatures.bStateSave;

           table.columns(5).every( function () {
                   let column = this;
           // Create select element
                   let select = document.createElement('select');
                   select.add(new Option(''));
                   column.header().append(select);
				  
                   // Apply listener for user change in value
                   select.addEventListener('change', function () {
                       var val = DataTable.util.escapeRegex(select.value);

                       column
                           .search(val ? '^' + val + '$' : '', true, false)
                           .draw();
                   });
                   select.addEventListener('click', function (e) {
                   	e.stopPropagation();
                   });
    
                   // Add list of options
                   column.data().unique().sort().each( function ( d, j ) {

                       if(column.search() === '^' + d + '$'){
                       	console.log("OK")
                       	var newOption = document.createElement("option");
						    newOption.text = d;
						    newOption.value = d;
						    newOption.selected="selected"
                           select.append(newOption);
                       
                           
                       } else {
                       	select.add(new Option(d));
                       }

                   } );
               });
       }
   });

	// Setup - add a text input to each header cell
	$('#example thead th:lt(3)').each(function() {
		
	    var title = $('#example thead th').eq($(this).index()).text();

	    $(this).html(title+'<input type="text" placeholder="請輸入..." />');

	});
	 
	// DataTable
	var table = $('#example').DataTable();
	 
	// Apply the search
	table.columns(':lt(3)').eq(0).each(function(colIdx) {
		var searchval=table.column(colIdx).search(this.value)
		if(searchval!==""){
			console.log(searchval)
			$('#example thead th').eq(colIdx).find('input').val(searchval);
	    }
		
		
	    $('input', table.column(colIdx).header()).on('keyup', function() {
	    	table
	            .column(colIdx)
	            .search(this.value)
	            .draw();	    	
	    });
	 
	    $('input', table.column(colIdx).header()).on('click', function(e) {
	        e.stopPropagation();
	    });
	});
	
   </script>
    <script th:src="@{/jquery/jquery-3.7.1.min.js}"></script>
  	<script th:src="@{/js/BackStage/notice/the.js}"></script>
  	<script th:src="@{/js/BackStage/notice/the2.js}"></script>
    <script>
//     	let table = new DataTable("#example");
//     	console.log($(".test"));
    // table.on("click", "tbody tr", function () {
    //   let data = table.row(this).data();
    //   alert("You clicked on " + data[3] + "'s row");
    // });
  	</script>
 </main>
    
</body>
</html>
